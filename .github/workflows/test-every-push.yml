name: "test-every-push"

on: push
jobs:
  test:
    name: test-every-push
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16

      #  <-> 캐시를 처리하는 카카오코드를 가져왔다
      - name: Cache node modules
        uses: actions/cache@v2
        # 캐시를 처리해주는 actions를 가져와서 사용한다.
        with:
          # node_modules라는 폴더를 검사하여
          path: node_modules
          # 아래 키값으로 cache가 돼있는지 확인합니다.
          key: npm-packages-${{ hashFiles('**/package-lock.json') }}

      - name: Install Dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run:
          npm install
          # 캐시여부에 따라서 install을 하거나 멈춘다.
          # <-> 여기 까지 캐시처리 부분

      - run: npm run lint
        if: ${{ always() }}
      - run: npm run test
        if: ${{ always() }}

    #  ${{ always() }} 문법을 통해 위에서 오류가 났다고 해도 아래의 테스트를 진행한다.
